// Description: Files and directories utilized by the malware
config case_sensitive = false
| dataset = xdr_data
| filter agent_os_type = ENUM.AGENT_OS_LINUX
| filter event_type = ENUM.FILE
// filter for some specific names
| filter action_file_path in ("/tmp/.perf.c/sh", "/tmp/httpd", "/usr/bin/wizlmsh","/.local/bin/ldd","/.local/bin/top", "/.local/bin/crontab", "/.local/bin/lsof", "/etc/ld.so.preload", "~/.profile") or action_file_name in("libgcwrap.so","perfctl","libpprocps.so","perfcc","libfsnkdev.so")
| fields agent_hostname, actor_effective_username, causality_actor_process_image_path, causality_actor_process_command_line, actor_process_command_line, action_file_path, action_file_name

----

// Description: File write to /tmp, chmod, and execute
config case_sensitive = false
| dataset = xdr_data
| filter agent_os_type = ENUM.AGENT_OS_LINUX
| filter event_type = ENUM.FILE AND (event_sub_type = ENUM.FILE_WRITE or event_sub_type = ENUM.FILE_CREATE_NEW ) and (action_file_path ~= "^\/tmp\/.*")
| fields agent_hostname, actor_effective_username, actor_process_image_path, actor_process_image_command_line, action_file_path, action_file_name 
//Lets Join with chmod event
| join ( dataset = xdr_data
    | filter agent_os_type = ENUM.AGENT_OS_LINUX
    | filter event_type = ENUM.FILE and event_sub_type = ENUM.FILE_CHANGE_MODE
    | filter actor_process_image_command_line  contains "+x"
    | fields agent_hostname, actor_effective_username ,actor_process_image_command_line as chmoder_process, action_file_path
) as proc proc.action_file_path = action_file_path and proc.agent_hostname = agent_hostname 
// Use this section carefully, read note below
| join ( dataset = xdr_data
    | filter agent_os_type = ENUM.AGENT_OS_LINUX
    | filter event_type = ENUM.PROCESS and event_sub_type = ENUM.PROCESS_START and (action_process_image_path ~= "^\/tmp\/.*")
    | fields agent_hostname, actor_effective_username, action_process_image_command_line as exec_process, action_process_image_path
) as exec exec.action_process_image_path = action_file_path and exec.agent_hostname = agent_hostname
| fields agent_hostname, actor_effective_username, actor_process_image_command_line, action_file_path, action_file_name