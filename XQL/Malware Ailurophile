Queries:
// Start query 1
// Description: AILUROPHILE samples communicate to the ipify and telegram APIs for C2 and environment check functionality. This query looks for any process communicating to both domains.
config case_sensitive=false
| dataset=xdr_data 
| fields event_type, agent_hostname, actor_process_instance_id, causality_actor_process_image_name, actor_process_image_command_line, actor_process_image_sha256, dst_action_external_hostname 
| filter event_type=ENUM.STORY and dst_action_external_hostname = "api.telegram.org" and causality_actor_process_image_name not in ("chrome.exe","firefox.exe","msedge.exe","msedgewebview2.exe","Google Chrome","infatica_agent.exe")
| dedup actor_process_instance_id 
| join (
    config case_sensitive=false
    | dataset=xdr_data 
    | fields event_type, dst_action_external_hostname, agent_hostname, actor_process_instance_id, actor_process_image_command_line, actor_process_image_sha256 , causality_actor_process_image_name
    | filter event_type=ENUM.STORY and dst_action_external_hostname = "api.ipify.org" and causality_actor_process_image_name not in ("chrome.exe","firefox.exe","msedge.exe","msedgewebview2.exe","Google Chrome","infatica_agent.exe")
    | dedup actor_process_instance_id 
) as ipcheck actor_process_instance_id = ipcheck.actor_process_instance_id 

// Start query 2
// Description: Ailurophile has been observed writing into directories with AILUROPHILE in the name. Likewise samples have been spotted in the wild with deepnude or ailurophile in the name. 
config case_sensitive = false 
|dataset = alerts 
| filter cgo_name IN ("*deepnude*","*AILUROPHILE*") or file_path contains "AILUROPHILE"
 
// Start query 3
// Description: Powershell executed via CMD calling Windows DPAPI Unprotect with a pre-set buffer. 
config case_sensitive=false
| dataset=xdr_data
| fields event_sub_type, action_process_image_name, action_process_image_command_line, agent_hostname, action_process_instance_id  
| filter event_sub_type = ENUM.PROCESS_START and action_process_image_name IN ("cmd.exe","powershell.exe") and action_process_image_command_line ~= "Unprotect.*80,11,180,142,201,183,199,3,163,126,171,48,0,0,0,161,69,175,216,205,240,131,185,30,177,117,113,252,102,32,126,83,79,188,43,128,65,167,26,134,225,44,13,99,79,123,32,17,75,202,110,63,101,86,243,0,21,5,123,230,109,67,213,64,0,0,0,149,53,50,191,66,141,26,192,34,209,190,2,216,164,2,112,39,79,3,9,219,138,111,92,183,241,210,174,175,46,182,222,97,81,51,160,185,124,180,234"

